<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pendaftaran Ekstrakurikuler Sekolah</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e24101;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #e66007;
      color: white;
      text-align: center;
      padding: 20px 0;
    }

    h2 {
      color: #1532d4;
    }

    main {
      width: 80%;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #0928db;
      color: white;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    input, select, textarea, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }

    button {
      background-color: #1a17d8;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0c368f;
    }

    #hasilPendaftaran {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <header>
    <h1>Daftar Ekstrakurikuler Sekolah</h1>
  </header>

  <main>
    <section>
      <h2>Tabel Ekstrakurikuler</h2>
      <table>
        <tr>
          <th>No</th>
          <th>Nama Ekstrakurikuler</th>
          <th>Pembimbing</th>
          <th>Hari Latihan</th>
        </tr>
        <tr>
          <td>1</td>
          <td>Paskibra</td>
          <td>Bapak Fauzan Azami</td>
          <td>Senin, Kamis dan Jumat</td>
        </tr>
        <tr>
          <td>2</td>
          <td>Dance Modern</td>
          <td>Bapak Shaqi</td>
          <td>Selasa & Jumat</td>
        </tr>
        <tr>
          <td>3</td>
          <td>Club Bahasa Jepang</td>
          <td>Rizki Sensei</td>
          <td>Jumat</td>
        </tr>
        <tr>
          <td>4</td>
          <td>Pramuka</td>
          <td>Bapak Daffa</td>
          <td>Jumat</td>
        </tr>
        <tr>
          <td>5</td>
          <td>Student Company</td>
          <td>Bapak shultan</td>
          <td>Selasa</td>
        </tr>
        <tr>
          <td>6</td>
          <td>Tari</td>
          <td>Bu Echa</td>
          <td>Senin - Jumat</td>
        </tr>
        <tr>
          <td>7</td>
          <td>Silat</td>
          <td>Bapak Gantar</td>
          <td>Senin & Rabu</td>
        </tr>
        <tr>
          <td>8</td>
          <td>Berenang</td>
          <td>Bapak Aulia</td>
          <td>Sebulan Sekali</td>
        </tr>
        <tr>
          <td>9</td>
          <td>Futsal</td>
          <td>Bapak Lutfi</td>
          <td>Setiap Hari</td>
        </tr>
        <tr>
          <td>10</td>
          <td>PMR</td>
          <td>Bapak Ashabul</td>
          <td>Setiap Hari</td>
        </tr>
      </table>
    </section>

    <section>
      <h2>Formulir Pendaftaran</h2>
      <form id="formPendaftaran">
        <label>Nama Lengkap:</label>
        <input type="text" id="nama" placeholder="Masukkan nama lengkap" required>

        <label>Kelas:</label>
        <input type="text" id="kelas" placeholder="Misal: XI RPL 1" required>

        <label>Pilih Ekstrakurikuler:</label>
        <select id="ekskul" required>
          <option value=""> Pilih Ekstrakurikuler</option>
          <option value="Paskibra">Paskibra</option>
          <option value="Dance Modern">Dance Modern</option>
          <option value="Club Bahasa Jepang">Club Bahasa Jepang</option>
          <option value="Pramuka">Pramuka</option>
          <option value="Student Company">Student Company</option>
          <option value="Tari">Tari</option>
          <option value="Silat">Silat</option>
          <option value="Berenang">Berenang</option>
          <option value="Futsal">Futsal</option>
          <option value="PMR">PMR</option>
        </select>

        <label>Alasan Bergabung:</label>
        <textarea id="alasan" rows="3" placeholder="Tulis alasan kamu bergabung..." required></textarea>

        <button type="submit">Daftar Sekarang</button>
      </form>
    </section>

    <section id="hasilPendaftaran">
      <h2>Daftar Pendaftar</h2>
      <table id="tabelHasil">
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Kelas</th>
          <th>Ekstrakurikuler</th>
          <th>Alasan</th>
          <th>Aksi</th>
        </tr>
      </table>
    </section>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    const form = document.getElementById("formPendaftaran");
    const tabelHasil = document.getElementById("tabelHasil");
    const btnSubmit = document.getElementById("btnSubmit");
    const btnBatal = document.getElementById("btnBatal");

    let nomor = 1;
    let editRow = null;

    form.addEventListener("submit", function (event) {
      event.preventDefault(); // mencegah reload halaman

      const nama = document.getElementById("nama").value.trim();
      const kelas = document.getElementById("kelas").value.trim();
      const ekskul = document.getElementById("ekskul").value;
      const alasan = document.getElementById("alasan").value.trim();

      if (!nama || !kelas || !ekskul || !alasan) {
        alert("Semua field harus diisi!");
        return;
      }

      if (editRow) {
        // Update data baris editRow
        editRow.cells[1].textContent = nama;
        editRow.cells[2].textContent = kelas;
        editRow.cells[3].textContent = ekskul;
        editRow.cells[4].textContent = alasan;

        alert("Data berhasil diperbarui!");
        editRow = null;
        btnSubmit.textContent = "Daftar Sekarang";
        btnBatal.style.display = "none";
      } else {
        // Tambah data baru
        const baris = tabelHasil.insertRow();
        baris.insertCell(0).textContent = nomor++;
        baris.insertCell(1).textContent = nama;
        baris.insertCell(2).textContent = kelas;
        baris.insertCell(3).textContent = ekskul;
        baris.insertCell(4).textContent = alasan;

        // Buat cell aksi (edit & hapus)
        const cellAksi = baris.insertCell(5);

        const btnEdit = document.createElement("button");
        btnEdit.textContent = "Edit";
        btnEdit.className = "btn-edit";
        btnEdit.addEventListener("click", () => {
          editRow = baris;
          document.getElementById("nama").value = baris.cells[1].textContent;
          document.getElementById("kelas").value = baris.cells[2].textContent;
          document.getElementById("ekskul").value = baris.cells[3].textContent;
          document.getElementById("alasan").value = baris.cells[4].textContent;

          btnSubmit.textContent = "Update Data";
          btnBatal.style.display = "inline-block";
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        const btnHapus = document.createElement("button");
        btnHapus.textContent = "Hapus";
        btnHapus.className = "btn-hapus";
        btnHapus.addEventListener("click", () => {
          if (confirm("Yakin ingin menghapus data ini?")) {
            // Jika baris yang dihapus ada di tengah, update nomor semua baris berikutnya
            const rowIndex = baris.rowIndex;
            tabelHasil.deleteRow(rowIndex);

            // Update nomor
            nomor = 1;
            for (let i = 1; i < tabelHasil.rows.length; i++) {
              tabelHasil.rows[i].cells[0].textContent = nomor++;
            }
            alert("Data berhasil dihapus!");
          }
        });

        cellAksi.appendChild(btnEdit);
        cellAksi.appendChild(btnHapus);

        alert("Pendaftaran berhasil!");
      }

      form.reset();
    });

    // Tombol batal edit
    btnBatal.addEventListener("click", () => {
      editRow = null;
      form.reset();
      btnSubmit.textContent = "Daftar Sekarang";
      btnBatal.style.display = "none";
    });

    // Fungsi cetak PDF dari tabelHasil menggunakan html2canvas + jsPDF
    document.getElementById("cetakPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF("p", "pt", "a4");
      const tabel = document.getElementById("tabelHasil");

      html2canvas(tabel, { scale: 2 }).then((canvas) => {
        const imgData = canvas.toDataURL("image/png");
        const imgProps = doc.getImageProperties(imgData);
        const pdfWidth = doc.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        doc.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
        doc.save("daftar_pendaftar.pdf");
      });
    });
  </script>
</body>
</html>